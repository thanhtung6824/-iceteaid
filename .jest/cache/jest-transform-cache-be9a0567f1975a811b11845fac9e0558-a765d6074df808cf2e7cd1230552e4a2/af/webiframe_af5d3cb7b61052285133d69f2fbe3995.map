{"version":3,"sources":["/home/admin1/Desktop/@iceteaid/packages/web/src/web-iframe.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,IAAA,eAAA,GAAA,OAAA,CAAA,eAAA,CAAA;;AAGA,IAAM,aAAa,GAAG,UAAC,KAAD,EAAc;AAChC,SAAO,CAAC,CAAC,QAAQ,CAAC,cAAT,CAAwB,KAAxB,CAAT;AACH,CAFD;;AAIA,IAAA,SAAA;AAAA;AAAA,UAAA,MAAA,EAAA;AAA+B,EAAA,SAAA,CAAA,SAAA,EAAA,MAAA,CAAA;;AAA/B,WAAA,SAAA,GAAA;AAAA,QAAA,KAAA,GAAA,MAAA,KAAA,IAAA,IAAA,MAAA,CAAA,KAAA,CAAA,IAAA,EAAA,SAAA,CAAA,IAAA,IAAA;;AAEY,IAAA,KAAA,CAAA,aAAA,GAAgB,KAAhB;;AA2DX;;AAzDmB,EAAA,SAAA,CAAA,SAAA,CAAA,SAAA,GAAhB,YAAA;;;;;;;AACI,YAAA,EAAA,GAAA,IAAA;AAAc,mBAAA,CAAA;AAAA;AAAA,cAAM,KAAK,YAAL,EAAN,CAAA;;;AAAd,YAAA,EAAA,CAAK,MAAL,GAAc,EAAA,CAAA,IAAA,EAAd;;;;;;;AACH,GAFe;;AAIN,EAAA,SAAA,CAAA,SAAA,CAAA,YAAA,GAAV,YAAA;AAAA,QAAA,KAAA,GAAA,IAAA;;AACI,WAAO,IAAI,OAAJ,CAAY,UAAC,OAAD,EAAQ;AACvB,UAAI,CAAC,aAAa,CAAC,KAAI,CAAC,KAAN,CAAlB,EAAgC;AAC5B,YAAM,MAAM,GAAG,QAAQ,CAAC,aAAT,CAAuB,QAAvB,CAAf;AACA,QAAA,MAAM,CAAC,YAAP,CAAoB,KAApB,EAA2B,KAAI,CAAC,QAAhC;AACA,QAAA,MAAM,CAAC,YAAP,CAAoB,IAApB,EAA0B,KAAI,CAAC,KAA/B;AACA,QAAA,MAAM,CAAC,KAAP,CAAa,KAAb,GAAqB,OAArB;AACA,QAAA,MAAM,CAAC,KAAP,CAAa,MAAb,GAAsB,OAAtB;AACA,QAAA,MAAM,CAAC,KAAP,CAAa,OAAb,GAAuB,MAAvB;AACA,QAAA,QAAQ,CAAC,IAAT,CAAc,WAAd,CAA0B,MAA1B;AACA,QAAA,OAAO,CAAC,MAAD,CAAP;AACH;AACJ,KAXM,CAAP;AAYH,GAbS;;AAeA,EAAA,SAAA,CAAA,SAAA,CAAA,WAAA,GAAV,YAAA;AACI,QAAM,MAAM,GAAG,QAAQ,CAAC,cAAT,CAAwB,KAAK,KAA7B,CAAf;;AACA,QAAI,MAAJ,EAAY;AACR,MAAA,MAAM,CAAC,KAAP,CAAa,OAAb,GAAuB,MAAvB;AACA;AACH;;AACD,UAAM,eAAA,CAAA,cAAA,EAAN;AACH,GAPS;;AASA,EAAA,SAAA,CAAA,SAAA,CAAA,UAAA,GAAV,YAAA;AACI,QAAM,MAAM,GAAG,QAAQ,CAAC,cAAT,CAAwB,KAAK,KAA7B,CAAf;;AACA,QAAI,MAAJ,EAAY;AACR,MAAA,MAAM,CAAC,KAAP,CAAa,OAAb,GAAuB,OAAvB;AACA;AACH;;AACD,UAAM,eAAA,CAAA,cAAA,EAAN;AACH,GAPS;;AASG,EAAA,SAAA,CAAA,SAAA,CAAA,WAAA,GAAb,UAAyB,OAAzB,EAAwC;;;;;AACpC,mBAAA,CAAA;AAAA;AAAA,cAAM,KAAK,OAAL,EAAN,CAAA;;;AAAA,YAAA,EAAA,CAAA,IAAA;;AACA,gBAAI,KAAK,MAAL,IAAe,KAAK,MAAL,CAAY,aAA/B,EAA8C;AAC1C,qBAAA,CAAA;AAAA;AAAA,gBAAO,KAAK,MAAL,CAAY,aAAZ,CAA0B,WAA1B,CAAsC,OAAtC,EAA+C,KAAK,QAApD,CAAP,CAAA;AACH;;AACD,kBAAM,eAAA,CAAA,cAAA,EAAN;;;;AACH,GANY;;AAQA,EAAA,SAAA,CAAA,SAAA,CAAA,OAAA,GAAb,YAAA;;;;;AACI,YAAI,CAAC,KAAK,aAAV,EAAyB;AACrB,iBAAA,CAAA;AAAA;AAAA,YAAO,IAAI,OAAJ,CAAY,UAAC,OAAD,EAAQ;AACvB,gBAAM,MAAM,GAAG,QAAQ,CAAC,cAAT,CAAwB,KAAI,CAAC,KAA7B,CAAf;AACA,YAAA,MAAM,CAAC,gBAAP,CAAwB,MAAxB,EAAgC,YAAA;AAC5B,cAAA,KAAI,CAAC,aAAL,GAAqB,IAArB;AACA,cAAA,OAAO;AACV,aAHD;AAIH,WANM,CAAP,CAAA;AAOH;;AACD,eAAA,CAAA;AAAA;AAAA,UAAO,OAAO,CAAC,OAAR,CAAgB,IAAhB,CAAP,CAAA;;;AACH,GAXY;;AAYjB,SAAA,SAAA;AAAC,CA7DD,CAA+B,eAAA,CAAA,MAA/B,CAAA;;AAAa,OAAA,CAAA,SAAA,GAAA,SAAA","sourcesContent":["import { Iframe, viewIsNotReady } from 'iceteaid-core';\nimport { WebTransporter } from './web-transporter';\n\nconst isIframeExist = (eleId: string) => {\n    return !!document.getElementById(eleId);\n};\n\nexport class WebIframe extends Iframe<WebTransporter> {\n    private iframe!: HTMLIFrameElement;\n    private isIframeReady = false;\n\n    protected async bootstrap(): Promise<void> {\n        this.iframe = await this.createIframe();\n    }\n\n    protected createIframe(): Promise<HTMLIFrameElement> {\n        return new Promise((resolve) => {\n            if (!isIframeExist(this.sdkId)) {\n                const iframe = document.createElement('iframe');\n                iframe.setAttribute('src', this.endpoint);\n                iframe.setAttribute('id', this.sdkId);\n                iframe.style.width = '640px';\n                iframe.style.height = '480px';\n                iframe.style.display = 'none';\n                document.body.appendChild(iframe);\n                resolve(iframe);\n            }\n        });\n    }\n\n    protected closeIframe(): void {\n        const iframe = document.getElementById(this.sdkId);\n        if (iframe) {\n            iframe.style.display = 'none';\n            return;\n        }\n        throw viewIsNotReady();\n    }\n\n    protected openIframe(): void {\n        const iframe = document.getElementById(this.sdkId);\n        if (iframe) {\n            iframe.style.display = 'block';\n            return;\n        }\n        throw viewIsNotReady();\n    }\n\n    public async postMessage(payload: string): Promise<void> {\n        await this.isReady();\n        if (this.iframe && this.iframe.contentWindow) {\n            return this.iframe.contentWindow.postMessage(payload, this.endpoint);\n        }\n        throw viewIsNotReady();\n    }\n\n    public async isReady(): Promise<any> {\n        if (!this.isIframeReady) {\n            return new Promise((resolve) => {\n                const iframe = document.getElementById(this.sdkId) as HTMLIFrameElement;\n                iframe.addEventListener('load', () => {\n                    this.isIframeReady = true;\n                    resolve();\n                });\n            });\n        }\n        return Promise.resolve(true);\n    }\n}"]}