{"version":3,"sources":["/home/admin1/Desktop/@iceteaid/packages/web/test/web.transporter.test.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * @jest-environment jsdom\n */\nimport { createWebTransporter } from './mock';\nimport { randomId, subjectBuilder } from 'iceteaid-core';\n\nbeforeEach(() => {\n    const iframe = document.getElementById('aaa');\n    if (iframe && iframe.parentNode) {\n        iframe.parentNode.removeChild(iframe);\n    }\n});\n\nit ('Will listener event message', async () => {\n    const transporter = createWebTransporter();\n    const map = {} as any;\n    window.addEventListener = jest.fn((event: string, cb: any) => {\n        map[event] = cb;\n    });\n    (transporter as any).bootstrap();\n    expect(map.message).toBeDefined();\n});\n\nit ('Will ignore message from difference endpoint', async () => {\n    const transporter = createWebTransporter();\n    const id = randomId();\n    const subject = subjectBuilder(id, transporter.messageHandlers);\n    const map = {} as any;\n    window.addEventListener = jest.fn((event: string, cb: any) => {\n        map[event] = cb;\n    });\n    (transporter as any).bootstrap();\n    const event = {\n        origin: 'aha',\n        data: JSON.stringify({ id, msg: 'Hey! Im test' })\n    };\n    map.message(event);\n    expect(subject.getValue()).toEqual('');\n});\n\nit ('Will ignore message if difference id', async () => {\n    const transporter = createWebTransporter();\n    const id = randomId();\n    const subject = subjectBuilder(id, transporter.messageHandlers);\n    const map = {} as any;\n    window.addEventListener = jest.fn((event: string, cb: any) => {\n        map[event] = cb;\n    });\n    (transporter as any).bootstrap();\n    const event = {\n        origin: 'xxx',\n        data: JSON.stringify({ id: 123, msg: 'Hey! Im test' })\n    };\n    map.message(event);\n    expect(subject.getValue()).toEqual('');\n});\n\nit('Will received message', async () => {\n    const transporter = createWebTransporter();\n    const id = randomId();\n    const subject = subjectBuilder(id, transporter.messageHandlers);\n\n    const map = {} as any;\n    window.addEventListener = jest.fn((event: string, cb: any) => {\n        map[event] = cb;\n    });\n    (transporter as any).bootstrap();\n    const event = {\n        origin: 'xxx',\n        data: JSON.stringify({ id, msg: 'Hey! Im test' })\n    };\n    map.message(event);\n    expect(subject.getValue()).toStrictEqual({ id, msg: 'Hey! Im test' });\n});"]}