4e904505b426322642cefc3ff3986114
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
/**
 * @jest-environment jsdom
 */

var auth_1 = require("../../../src/api/auth");

var mocks_1 = require("../../mocks");

var src_1 = require("../../../src");

describe('SendOtp run correctly', function () {
  var testSdk = new mocks_1.TestSdk('xxx');
  var testApi = new auth_1.AuthApi(testSdk);
  it('Work when pass parameter', function () {
    var mockPost = jest.fn();
    testApi.transporter.post = mockPost;
    testApi.sendOtp('abc', 'def');
    expect(mockPost).toBeCalledTimes(1);
  });
  it('Throw error when not pass parameter', function () {
    try {
      testApi.sendOtp();
      expect(true).toBe(false);
    } catch (err) {
      expect(err.message).toBe('IceteaID Error: [MISSING_PARAMETER] Parameter EMAIL_OR_PHONE is required');
      expect(err).toBeInstanceOf(Error);
    }
  });
  it('Throw error when pass emailOrPhone and not pass channel', function () {
    try {
      testApi.sendOtp('abc');
      expect(true).toBe(false);
    } catch (err) {
      expect(err.message).toBe('IceteaID Error: [MISSING_PARAMETER] Parameter CHANNEL is required');
      expect(err).toBeInstanceOf(Error);
    }
  });
  it('Throw error when not pass emailOrPhone and pass channel', function () {
    try {
      testApi.sendOtp('', 'abc');
      expect(true).toBe(false);
    } catch (err) {
      expect(err.message).toBe('IceteaID Error: [MISSING_PARAMETER] Parameter EMAIL_OR_PHONE is required');
      expect(err).toBeInstanceOf(Error);
    }
  });
});
describe('VerifyOtp run correctly', function () {
  var testSdk = new mocks_1.TestSdk('xxx');
  var testApi = new auth_1.AuthApi(testSdk);
  it('Work when pass parameter', function () {
    var mockPost = jest.fn();
    testApi.transporter.post = mockPost;
    testApi.verifyOtp('abc', 'def');
    expect(mockPost).toBeCalledTimes(1);
  });
  it('Throw error when not pass parameter', function () {
    try {
      testApi.verifyOtp();
      expect(true).toBe(false);
    } catch (err) {
      expect(err.message).toBe('IceteaID Error: [MISSING_PARAMETER] Parameter EMAIL_OR_PHONE is required');
      expect(err).toBeInstanceOf(Error);
    }
  });
  it('Throw error when pass emailOrPhone and not pass channel', function () {
    try {
      testApi.verifyOtp('abc');
      expect(true).toBe(false);
    } catch (err) {
      expect(err.message).toBe('IceteaID Error: [MISSING_PARAMETER] Parameter CHANNEL is required');
      expect(err).toBeInstanceOf(Error);
    }
  });
  it('Throw error when not pass emailOrPhone and pass channel', function () {
    try {
      testApi.verifyOtp('', 'abc');
      expect(true).toBe(false);
    } catch (err) {
      expect(err.message).toBe('IceteaID Error: [MISSING_PARAMETER] Parameter EMAIL_OR_PHONE is required');
      expect(err).toBeInstanceOf(Error);
    }
  });
});
describe('Login with google run correctly', function () {
  var testSdk = new mocks_1.TestSdk('xxx');
  var testApi = new auth_1.AuthApi(testSdk);
  it('Work when target is react-native', function () {
    var mockPost = jest.fn();
    testApi.transporter.post = mockPost;
    src_1.SdkConfiguration.target = 'react-native';
    testApi.loginWithGoogle();
    expect(mockPost).toBeCalledTimes(1);
  });
  it('Throw error when target is react-native and have redirect url', function () {
    try {
      src_1.SdkConfiguration.target = 'react-native';
      testApi.loginWithGoogle('redirect');
      expect(true).toBe(false);
    } catch (err) {
      expect(err.message).toBe('IceteaID Error: [INVALID_PARAMETER] Parameter REDIRECT_URI is invalid');
      expect(err).toBeInstanceOf(Error);
    }
  });
  it('Redirect when target is web', function () {
    src_1.SdkConfiguration.target = 'web';
    var sdkId = btoa(JSON.stringify({
      apiKey: 'xxx',
      target: 'web',
      baseUrl: 'http://3k.theydont.work'
    }));
    var url = "http://3k1.theydont.work/account/google?sdkId=" + sdkId + "&redirectUri=redirect";
    Object.defineProperty(window, 'location', {
      value: new URL(url)
    });
    testApi.loginWithGoogle('redirect');
    expect(window.location.href).toEqual(url);
  });
  it('Throw error when target is web and dont have redirect url', function () {
    try {
      src_1.SdkConfiguration.target = 'web';
      testApi.loginWithGoogle();
      expect(true).toBe(false);
    } catch (err) {
      expect(err.message).toBe('IceteaID Error: [MISSING_PARAMETER] Parameter REDIRECT_URI is required');
      expect(err).toBeInstanceOf(Error);
    }
  });
});
describe('Logout run correctly', function () {
  var testSdk = new mocks_1.TestSdk('xxx');
  var testApi = new auth_1.AuthApi(testSdk);
  it('Worked', function () {
    var mockPost = jest.fn();
    testApi.transporter.post = mockPost;
    testApi.logout();
    expect(mockPost).toBeCalledTimes(1);
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9ob21lL2FkbWluMS9EZXNrdG9wL0BpY2V0ZWFpZC9wYWNrYWdlcy9jb3JlL3Rlc3QvYXBpL2F1dGgvaW5kZXgudGVzdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBOzs7O0FBR0EsSUFBQSxNQUFBLEdBQUEsT0FBQSxDQUFBLHVCQUFBLENBQUE7O0FBQ0EsSUFBQSxPQUFBLEdBQUEsT0FBQSxDQUFBLGFBQUEsQ0FBQTs7QUFDQSxJQUFBLEtBQUEsR0FBQSxPQUFBLENBQUEsY0FBQSxDQUFBOztBQUVBLFFBQVEsQ0FBQyx1QkFBRCxFQUEwQixZQUFBO0FBQzlCLE1BQU0sT0FBTyxHQUFHLElBQUksT0FBQSxDQUFBLE9BQUosQ0FBWSxLQUFaLENBQWhCO0FBQ0EsTUFBTSxPQUFPLEdBQUcsSUFBSSxNQUFBLENBQUEsT0FBSixDQUFZLE9BQVosQ0FBaEI7QUFFQSxFQUFBLEVBQUUsQ0FBRSwwQkFBRixFQUE4QixZQUFBO0FBQzVCLFFBQU0sUUFBUSxHQUFHLElBQUksQ0FBQyxFQUFMLEVBQWpCO0FBQ0EsSUFBQSxPQUFPLENBQUMsV0FBUixDQUFvQixJQUFwQixHQUEyQixRQUEzQjtBQUNBLElBQUEsT0FBTyxDQUFDLE9BQVIsQ0FBZ0IsS0FBaEIsRUFBdUIsS0FBdkI7QUFDQSxJQUFBLE1BQU0sQ0FBQyxRQUFELENBQU4sQ0FBaUIsZUFBakIsQ0FBaUMsQ0FBakM7QUFDSCxHQUxDLENBQUY7QUFPQSxFQUFBLEVBQUUsQ0FBRSxxQ0FBRixFQUF5QyxZQUFBO0FBQ3ZDLFFBQUk7QUFDQSxNQUFBLE9BQU8sQ0FBQyxPQUFSO0FBQ0EsTUFBQSxNQUFNLENBQUMsSUFBRCxDQUFOLENBQWEsSUFBYixDQUFrQixLQUFsQjtBQUNILEtBSEQsQ0FHRSxPQUFPLEdBQVAsRUFBWTtBQUNWLE1BQUEsTUFBTSxDQUFDLEdBQUcsQ0FBQyxPQUFMLENBQU4sQ0FBb0IsSUFBcEIsQ0FBeUIsMEVBQXpCO0FBQ0EsTUFBQSxNQUFNLENBQUMsR0FBRCxDQUFO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QTJCLEtBQTNCO0FBQ0g7QUFDSixHQVZDLENBQUY7QUFXSCxDQWxETyxDQUFSO0FBb0RBLFFBQVEsQ0FBQyxzQkFBRCxFQUF5QixZQUFBO0FBQzdCLE1BQU0sT0FBTyxHQUFHLElBQUksT0FBQSxDQUFBLE9BQUosQ0FBWSxLQUFaLENBQWhCO0FBQ0EsTUFBTSxPQUFPLEdBQUcsSUFBSSxNQUFBLENBQUEsT0FBSixDQUFZLE9BQVosQ0FBaEI7QUFFQSxFQUFBLEVBQUUsQ0FBQyxRQUFELEVBQVcsWUFBQTtBQUNULFFBQU0sUUFBUSxHQUFHLElBQUksQ0FBQyxFQUFMLEVBQWpCO0FBQ0EsSUFBQSxPQUFPLENBQUMsV0FBUixDQUFvQixJQUFwQixHQUEyQixRQUEzQjtBQUNBLElBQUEsT0FBTyxDQUFDLE1BQVI7QUFDQSxJQUFBLE1BQU0sQ0FBQyxRQUFELENBQU4sQ0FBaUIsZUFBakIsQ0FBaUMsQ0FBakM7QUFDSCxHQUxDLENBQUY7QUFNSCxDQVZPLENBQVIiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEBqZXN0LWVudmlyb25tZW50IGpzZG9tXG4gKi9cbmltcG9ydCB7IEF1dGhBcGkgfSBmcm9tICcuLi8uLi8uLi9zcmMvYXBpL2F1dGgnO1xuaW1wb3J0IHsgVGVzdFNkayB9IGZyb20gJy4uLy4uL21vY2tzJztcbmltcG9ydCB7IFNka0NvbmZpZ3VyYXRpb24gfSBmcm9tICcuLi8uLi8uLi9zcmMnO1xuXG5kZXNjcmliZSgnU2VuZE90cCBydW4gY29ycmVjdGx5JywgKCkgPT4ge1xuICAgIGNvbnN0IHRlc3RTZGsgPSBuZXcgVGVzdFNkaygneHh4Jyk7XG4gICAgY29uc3QgdGVzdEFwaSA9IG5ldyBBdXRoQXBpKHRlc3RTZGspIGFzIGFueTtcblxuICAgIGl0ICgnV29yayB3aGVuIHBhc3MgcGFyYW1ldGVyJywgKCkgPT4ge1xuICAgICAgICBjb25zdCBtb2NrUG9zdCA9IGplc3QuZm4oKTtcbiAgICAgICAgdGVzdEFwaS50cmFuc3BvcnRlci5wb3N0ID0gbW9ja1Bvc3Q7XG4gICAgICAgIHRlc3RBcGkuc2VuZE90cCgnYWJjJywgJ2RlZicpO1xuICAgICAgICBleHBlY3QobW9ja1Bvc3QpLnRvQmVDYWxsZWRUaW1lcygxKTtcbiAgICB9KTtcblxuICAgIGl0ICgnVGhyb3cgZXJyb3Igd2hlbiBub3QgcGFzcyBwYXJhbWV0ZXInLCAoKSA9PiB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICB0ZXN0QXBpLnNlbmRPdHAoKTtcbiAgICAgICAgICAgIGV4cGVjdCh0cnVlKS50b0JlKGZhbHNlKTtcbiAgICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgICBleHBlY3QoZXJyLm1lc3NhZ2UpLnRvQmUoJ0ljZXRlYUlEIEVycm9yOiBbTUlTU0lOR19QQVJBTUVURVJdIFBhcmFtZXRlciBFTUFJTF9PUl9QSE9ORSBpcyByZXF1aXJlZCcpO1xuICAgICAgICAgICAgZXhwZWN0KGVycikudG9CZUluc3RhbmNlT2YoRXJyb3IpO1xuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICBpdCAoJ1Rocm93IGVycm9yIHdoZW4gcGFzcyBlbWFpbE9yUGhvbmUgYW5kIG5vdCBwYXNzIGNoYW5uZWwnLCAoKSA9PiB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICB0ZXN0QXBpLnNlbmRPdHAoJ2FiYycpO1xuICAgICAgICAgICAgZXhwZWN0KHRydWUpLnRvQmUoZmFsc2UpO1xuICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICAgIGV4cGVjdChlcnIubWVzc2FnZSkudG9CZSgnSWNldGVhSUQgRXJyb3I6IFtNSVNTSU5HX1BBUkFNRVRFUl0gUGFyYW1ldGVyIENIQU5ORUwgaXMgcmVxdWlyZWQnKTtcbiAgICAgICAgICAgIGV4cGVjdChlcnIpLnRvQmVJbnN0YW5jZU9mKEVycm9yKTtcbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgaXQgKCdUaHJvdyBlcnJvciB3aGVuIG5vdCBwYXNzIGVtYWlsT3JQaG9uZSBhbmQgcGFzcyBjaGFubmVsJywgKCkgPT4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgdGVzdEFwaS5zZW5kT3RwKCcnLCAnYWJjJyk7XG4gICAgICAgICAgICBleHBlY3QodHJ1ZSkudG9CZShmYWxzZSk7XG4gICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgICAgZXhwZWN0KGVyci5tZXNzYWdlKS50b0JlKCdJY2V0ZWFJRCBFcnJvcjogW01JU1NJTkdfUEFSQU1FVEVSXSBQYXJhbWV0ZXIgRU1BSUxfT1JfUEhPTkUgaXMgcmVxdWlyZWQnKTtcbiAgICAgICAgICAgIGV4cGVjdChlcnIpLnRvQmVJbnN0YW5jZU9mKEVycm9yKTtcbiAgICAgICAgfVxuICAgIH0pO1xuXG59KTtcblxuZGVzY3JpYmUoJ1ZlcmlmeU90cCBydW4gY29ycmVjdGx5JywgKCkgPT4ge1xuICAgIGNvbnN0IHRlc3RTZGsgPSBuZXcgVGVzdFNkaygneHh4Jyk7XG4gICAgY29uc3QgdGVzdEFwaSA9IG5ldyBBdXRoQXBpKHRlc3RTZGspIGFzIGFueTtcblxuICAgIGl0ICgnV29yayB3aGVuIHBhc3MgcGFyYW1ldGVyJywgKCkgPT4ge1xuICAgICAgICBjb25zdCBtb2NrUG9zdCA9IGplc3QuZm4oKTtcbiAgICAgICAgdGVzdEFwaS50cmFuc3BvcnRlci5wb3N0ID0gbW9ja1Bvc3Q7XG4gICAgICAgIHRlc3RBcGkudmVyaWZ5T3RwKCdhYmMnLCAnZGVmJyk7XG4gICAgICAgIGV4cGVjdChtb2NrUG9zdCkudG9CZUNhbGxlZFRpbWVzKDEpO1xuICAgIH0pO1xuXG4gICAgaXQgKCdUaHJvdyBlcnJvciB3aGVuIG5vdCBwYXNzIHBhcmFtZXRlcicsICgpID0+IHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHRlc3RBcGkudmVyaWZ5T3RwKCk7XG4gICAgICAgICAgICBleHBlY3QodHJ1ZSkudG9CZShmYWxzZSk7XG4gICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgICAgZXhwZWN0KGVyci5tZXNzYWdlKS50b0JlKCdJY2V0ZWFJRCBFcnJvcjogW01JU1NJTkdfUEFSQU1FVEVSXSBQYXJhbWV0ZXIgRU1BSUxfT1JfUEhPTkUgaXMgcmVxdWlyZWQnKTtcbiAgICAgICAgICAgIGV4cGVjdChlcnIpLnRvQmVJbnN0YW5jZU9mKEVycm9yKTtcbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgaXQgKCdUaHJvdyBlcnJvciB3aGVuIHBhc3MgZW1haWxPclBob25lIGFuZCBub3QgcGFzcyBjaGFubmVsJywgKCkgPT4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgdGVzdEFwaS52ZXJpZnlPdHAoJ2FiYycpO1xuICAgICAgICAgICAgZXhwZWN0KHRydWUpLnRvQmUoZmFsc2UpO1xuICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICAgIGV4cGVjdChlcnIubWVzc2FnZSkudG9CZSgnSWNldGVhSUQgRXJyb3I6IFtNSVNTSU5HX1BBUkFNRVRFUl0gUGFyYW1ldGVyIENIQU5ORUwgaXMgcmVxdWlyZWQnKTtcbiAgICAgICAgICAgIGV4cGVjdChlcnIpLnRvQmVJbnN0YW5jZU9mKEVycm9yKTtcbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgaXQgKCdUaHJvdyBlcnJvciB3aGVuIG5vdCBwYXNzIGVtYWlsT3JQaG9uZSBhbmQgcGFzcyBjaGFubmVsJywgKCkgPT4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgdGVzdEFwaS52ZXJpZnlPdHAoJycsICdhYmMnKTtcbiAgICAgICAgICAgIGV4cGVjdCh0cnVlKS50b0JlKGZhbHNlKTtcbiAgICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgICBleHBlY3QoZXJyLm1lc3NhZ2UpLnRvQmUoJ0ljZXRlYUlEIEVycm9yOiBbTUlTU0lOR19QQVJBTUVURVJdIFBhcmFtZXRlciBFTUFJTF9PUl9QSE9ORSBpcyByZXF1aXJlZCcpO1xuICAgICAgICAgICAgZXhwZWN0KGVycikudG9CZUluc3RhbmNlT2YoRXJyb3IpO1xuICAgICAgICB9XG4gICAgfSk7XG59KTtcblxuZGVzY3JpYmUoJ0xvZ2luIHdpdGggZ29vZ2xlIHJ1biBjb3JyZWN0bHknLCAoKSA9PiB7XG4gICAgY29uc3QgdGVzdFNkayA9IG5ldyBUZXN0U2RrKCd4eHgnKTtcbiAgICBjb25zdCB0ZXN0QXBpID0gbmV3IEF1dGhBcGkodGVzdFNkaykgYXMgYW55O1xuICAgIGl0ICgnV29yayB3aGVuIHRhcmdldCBpcyByZWFjdC1uYXRpdmUnLCAoKSA9PiB7XG4gICAgICAgIGNvbnN0IG1vY2tQb3N0ID0gamVzdC5mbigpO1xuICAgICAgICB0ZXN0QXBpLnRyYW5zcG9ydGVyLnBvc3QgPSBtb2NrUG9zdDtcblxuICAgICAgICBTZGtDb25maWd1cmF0aW9uLnRhcmdldCA9ICdyZWFjdC1uYXRpdmUnO1xuICAgICAgICB0ZXN0QXBpLmxvZ2luV2l0aEdvb2dsZSgpO1xuICAgICAgICBleHBlY3QobW9ja1Bvc3QpLnRvQmVDYWxsZWRUaW1lcygxKTtcbiAgICB9KTtcblxuICAgIGl0ICgnVGhyb3cgZXJyb3Igd2hlbiB0YXJnZXQgaXMgcmVhY3QtbmF0aXZlIGFuZCBoYXZlIHJlZGlyZWN0IHVybCcsICgpID0+IHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIFNka0NvbmZpZ3VyYXRpb24udGFyZ2V0ID0gJ3JlYWN0LW5hdGl2ZSc7XG4gICAgICAgICAgICB0ZXN0QXBpLmxvZ2luV2l0aEdvb2dsZSgncmVkaXJlY3QnKTtcbiAgICAgICAgICAgIGV4cGVjdCh0cnVlKS50b0JlKGZhbHNlKTtcblxuICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICAgIGV4cGVjdChlcnIubWVzc2FnZSkudG9CZSgnSWNldGVhSUQgRXJyb3I6IFtJTlZBTElEX1BBUkFNRVRFUl0gUGFyYW1ldGVyIFJFRElSRUNUX1VSSSBpcyBpbnZhbGlkJyk7XG4gICAgICAgICAgICBleHBlY3QoZXJyKS50b0JlSW5zdGFuY2VPZihFcnJvcik7XG4gICAgICAgIH1cbiAgICB9KTtcblxuICAgIGl0ICgnUmVkaXJlY3Qgd2hlbiB0YXJnZXQgaXMgd2ViJywgKCkgPT4ge1xuICAgICAgICBTZGtDb25maWd1cmF0aW9uLnRhcmdldCA9ICd3ZWInO1xuICAgICAgICBjb25zdCBzZGtJZCA9IGJ0b2EoSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICAgICAgYXBpS2V5OiAneHh4JyxcbiAgICAgICAgICAgIHRhcmdldDogJ3dlYicsXG4gICAgICAgICAgICBiYXNlVXJsOiAnaHR0cDovLzNrLnRoZXlkb250LndvcmsnXG4gICAgICAgIH0pKTtcbiAgICAgICAgY29uc3QgdXJsID0gYGh0dHA6Ly8zazEudGhleWRvbnQud29yay9hY2NvdW50L2dvb2dsZT9zZGtJZD0ke3Nka0lkfSZyZWRpcmVjdFVyaT1yZWRpcmVjdGA7XG4gICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh3aW5kb3csICdsb2NhdGlvbicsIHtcbiAgICAgICAgICAgIHZhbHVlOiBuZXcgVVJMKHVybClcbiAgICAgICAgfSApO1xuICAgICAgICB0ZXN0QXBpLmxvZ2luV2l0aEdvb2dsZSgncmVkaXJlY3QnKTtcbiAgICAgICAgZXhwZWN0KHdpbmRvdy5sb2NhdGlvbi5ocmVmKS50b0VxdWFsKHVybCk7XG4gICAgfSk7XG5cbiAgICBpdCAoJ1Rocm93IGVycm9yIHdoZW4gdGFyZ2V0IGlzIHdlYiBhbmQgZG9udCBoYXZlIHJlZGlyZWN0IHVybCcsICgpID0+IHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIFNka0NvbmZpZ3VyYXRpb24udGFyZ2V0ID0gJ3dlYic7XG4gICAgICAgICAgICB0ZXN0QXBpLmxvZ2luV2l0aEdvb2dsZSgpO1xuICAgICAgICAgICAgZXhwZWN0KHRydWUpLnRvQmUoZmFsc2UpO1xuXG4gICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgICAgZXhwZWN0KGVyci5tZXNzYWdlKS50b0JlKCdJY2V0ZWFJRCBFcnJvcjogW01JU1NJTkdfUEFSQU1FVEVSXSBQYXJhbWV0ZXIgUkVESVJFQ1RfVVJJIGlzIHJlcXVpcmVkJyk7XG4gICAgICAgICAgICBleHBlY3QoZXJyKS50b0JlSW5zdGFuY2VPZihFcnJvcik7XG4gICAgICAgIH1cbiAgICB9KTtcbn0pO1xuXG5kZXNjcmliZSgnTG9nb3V0IHJ1biBjb3JyZWN0bHknLCAoKSA9PiB7XG4gICAgY29uc3QgdGVzdFNkayA9IG5ldyBUZXN0U2RrKCd4eHgnKTtcbiAgICBjb25zdCB0ZXN0QXBpID0gbmV3IEF1dGhBcGkodGVzdFNkaykgYXMgYW55O1xuXG4gICAgaXQoJ1dvcmtlZCcsICgpID0+IHtcbiAgICAgICAgY29uc3QgbW9ja1Bvc3QgPSBqZXN0LmZuKCk7XG4gICAgICAgIHRlc3RBcGkudHJhbnNwb3J0ZXIucG9zdCA9IG1vY2tQb3N0O1xuICAgICAgICB0ZXN0QXBpLmxvZ291dCgpO1xuICAgICAgICBleHBlY3QobW9ja1Bvc3QpLnRvQmVDYWxsZWRUaW1lcygxKTtcbiAgICB9KTtcbn0pOyJdfQ==